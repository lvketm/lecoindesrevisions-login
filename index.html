<!DOCTYPE html>
<html>
  <head>
    <title>Le Coin des Révisions – Login</title>
    <meta name="google-signin-client_id" content="879720349020-5ibqgn7i81fckep2pe2vq34pdamtid9d.apps.googleusercontent.com">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
  </head>
  <body>
    <h1>Bienvenue !</h1>
    <div id="g_id_onload"
         data-client_id="879720349020-5ibqgn7i81fckep2pe2vq34pdamtid9d.apps.googleusercontent.com"
         data-callback="handleLogin">
    </div>

    <div class="g_id_signin" data-type="standard"></div>

    <script>
      async function handleLogin(response) {
        const idToken = response.credential;

        // Send the token to your Apps Script web app for validation
        const res = await fetch("https://script.google.com/macros/s/AKfycbxB0l0ah1VQJuULFtNNx3Cu8zAyO4NQb42UIBpbF-tP7U1nMB2e0QPaupC78LYazbo8/exec", {
          method: "POST",
          body: JSON.stringify({ token: idToken }),
          headers: { "Content-Type": "application/json" },
        });

        const data = await res.json();

        if (data.status === "active") {
          window.location.href = "https://sites.google.com/view/lecoindesrevisions/main";
        } else {
          window.location.href = "https://buy.stripe.com/bIY6oDgR0cas6S44gg";
        }
      }
    </script>
  </body>
</html>
